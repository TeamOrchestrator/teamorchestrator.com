---
import Button from '../../../components/Button.astro';
import Card from '../../../components/Card.astro';
import Layout from '../../../layouts/Layout.astro';
import { getPostsByTagSlug, getPublishedPosts, getTagSummary } from '../../../lib/content';

export async function getStaticPaths() {
  const posts = await getPublishedPosts();
  const tags = getTagSummary(posts);

  return tags.map((tag) => ({
    params: { tag: tag.slug },
    props: { tagLabel: tag.tag },
  }));
}

const { tag } = Astro.params;
const { tagLabel } = Astro.props;
const posts = await getPublishedPosts();
const tagPosts = getPostsByTagSlug(posts, tag ?? '');
---

<Layout title={`${tagLabel} | Blog Tag`} description={`Blog posts tagged ${tagLabel}.`}>
  <section class="page-header">
    <div class="container">
      <p class="eyebrow">Blog</p>
      <h1>Tag: {tagLabel}</h1>
      <p class="lead">{tagPosts.length} post(s) in this topic.</p>
    </div>
  </section>

  <section class="section">
    <div class="container post-grid">
      {tagPosts.map((post) => (
        <Card>
          <h2><a href={`/blog/${post.slug}/`}>{post.data.title}</a></h2>
          <p>{post.data.description}</p>
          <p class="meta">{post.data.pubDate.toLocaleDateString()}</p>
        </Card>
      ))}
    </div>
    <div class="container">
      <p><Button href="/blog/tags" variant="secondary">Back to all tags</Button></p>
    </div>
  </section>
</Layout>
