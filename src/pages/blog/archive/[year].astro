---
import Layout from '../../../layouts/Layout.astro';
import { getArchiveSummary, getPostsByYear, getPublishedPosts } from '../../../lib/content';

export async function getStaticPaths() {
  const posts = await getPublishedPosts();
  const archive = getArchiveSummary(posts);

  return archive.map((entry) => ({
    params: { year: entry.year },
  }));
}

const { year } = Astro.params;
const posts = await getPublishedPosts();
const yearPosts = getPostsByYear(posts, year ?? '');
---

<Layout title={`${year} Archive | Team Orchestrator`} description={`Blog posts from ${year}.`}>
  <section class="page-header">
    <div class="container">
      <p class="eyebrow">Blog</p>
      <h1>Archive: {year}</h1>
      <p class="lead">{yearPosts.length} post(s) published in {year}.</p>
    </div>
  </section>

  <section class="section">
    <div class="container post-grid">
      {yearPosts.map((post) => (
        <article class="card">
          <h2><a href={`/blog/${post.slug}/`}>{post.data.title}</a></h2>
          <p>{post.data.description}</p>
          <p class="meta">{post.data.pubDate.toLocaleDateString()}</p>
        </article>
      ))}
    </div>
    <div class="container">
      <p><a href="/blog/archive">‚Üê Back to archive</a></p>
    </div>
  </section>
</Layout>